import os
import pefile
import json
import string_resolve
# shout-out to OALabs https://gist.github.com/OALabs/94ff4fc02bf02d55a8161068cafd11c0


string_offset_list = [0x7C3, 2914, 1149, 2536, 524, 2227, 1805]


INTERESTING_DLLS = []

for offset in string_offset_list:
    INTERESTING_DLLS.append(string_resolve.resolve_string(offset))

exports_list = []

for filename in os.listdir("C:\\Windows\\System32"):
    if filename.lower() in INTERESTING_DLLS:
        pe = pefile.PE("C:\\Windows\\System32\\" + filename)
        for exp in pe.DIRECTORY_ENTRY_EXPORT.symbols:
            try:
                exports_list.append(exp.name.decode('utf-8'))
            except:
                continue
exports_json = {'exports': exports_list}
open('exports.json', 'w').write(json.dumps(exports_json))
